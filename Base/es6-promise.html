<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Promise</title>
</head>
<body>
<div id="log">
    <h2>Log</h2>
</div>
<a href="javascript:insert()">Insert</a>
<script>
    var count = 0;
    function insert() {
        var thisCount = ++count;

        var log = document.getElementById('log');
        log.insertAdjacentHTML('beforeend', `(${thisCount}) Insert Started (<small>Sync code started</small>)<br/>`);

        var p1 = new Promise(function (resolve, reject) {
            log.insertAdjacentHTML('beforeend',
                    `(${thisCount}) Promise1 Started (<small>Async code started</small>)<br/>`);

            window.setTimeout(function () {
                var result = Math.random();
                if(result > 0.5) {
                    resolve({msg: 'success'});
                }else {
                    reject({msg: 'error'});
                }

            }, Math.random()*1000 + 3000);

        }).then(function (reason) {
            log.insertAdjacentHTML('beforeend',
                    `(${JSON.stringify(reason)}) Promise1 Fulfilled (<small>Async code started</small>)<br/>`);
            return reason;

        }).catch(function (reason) {
            log.insertAdjacentHTML('beforeend',
                    `(${JSON.stringify(reason)}) Promise1 rejected (<small>Async code started</small>)<br/>`);
            return reason;
        });

        var p2 = new Promise(function (resolve, reject) {
            log.insertAdjacentHTML('beforeend',
                    `(${thisCount}) Promise2 stated (<small>Async code started</small>)<br/>`);

            window.setTimeout(function () {
                var result = Math.random();
                if(result > 0.5) {
                    resolve('<strong>success</strong>');
                }else {
                    reject('<strong>error</strong>');
                }
            }, Math.random()*3000 + 1000);

        }).then(function (reason) {
            log.insertAdjacentHTML('beforeend',
                    `(${reason}) Promise2 Fulfilled (<small>Async code started</small>)<br/>`);
            return reason;

        }).catch(function (reason) {
            log.insertAdjacentHTML('beforeend',
                    `(${reason}) Promise2 rejected (<small>Async code started</small>)<br/>`);
            return reason;
        });


        log.insertAdjacentHTML('beforeend',
                `(${thisCount}) Promise all made (<small>Sync code started</small>)<br/>`);


        Promise.all([p1, p2]).then(function (reason) {
            console.log(reason);
            log.insertAdjacentHTML('beforeend',
                    `(${reason}) Promise all done (<small>Sync code started</small>)<br/>`);
        });

        Promise.race([p1, p2]).then(function (reason) {
            log.insertAdjacentHTML('beforeend',
                    `(${reason}) One promise done (<small>Sync code started</small>)<br/>`);
        })
    }
</script>
</body>
</html>